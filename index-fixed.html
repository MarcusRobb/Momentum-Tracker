<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Momentum: Time Boxing & LAPS Tracker</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM from CDN (UMD builds) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <!-- The root element for the React app -->
    <div id="root"></div>

    <!-- Load all components and utilities first -->
    <script type="text/babel">
      // UUID generation with fallback for older browsers
      const generateUUID = () => {
        if (typeof crypto !== 'undefined' && crypto.randomUUID) {
          return crypto.randomUUID();
        }
        // Fallback for older browsers
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          const r = Math.random() * 16 | 0;
          const v = c === 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        });
      };

      // Types (inline for simplicity)
      // Task interface: { id, text, isCompleted, isIncomeGenerating, notes, scheduledTime, completedAt?, duration? }
      // LapsData interface: { date, leads, appointments, presentations, sales }
      // AccountabilityData interface: { date, appointment, spokeToPerson, taughtSomeone, madeOffer }

      // useLocalStorage hook
      const useLocalStorage = (key, initialValue) => {
        const [storedValue, setStoredValue] = React.useState(() => {
          if (typeof window === 'undefined') {
            return initialValue;
          }
          try {
            const item = window.localStorage.getItem(key);
            return item ? JSON.parse(item) : initialValue;
          } catch (error) {
            console.error(error);
            return initialValue;
          }
        });

        const setValue = (value) => {
          try {
            const valueToStore = value instanceof Function ? value(storedValue) : value;
            setStoredValue(valueToStore);
            if (typeof window !== 'undefined') {
              window.localStorage.setItem(key, JSON.stringify(valueToStore));
            }
          } catch (error) {
            console.error(error);
          }
        };

        React.useEffect(() => {
          const handleStorageChange = (e) => {
            if (e.key === key && e.newValue) {
              setStoredValue(JSON.parse(e.newValue));
            }
          };
          window.addEventListener('storage', handleStorageChange);
          return () => window.removeEventListener('storage', handleStorageChange);
        }, [key]);

        return [storedValue, setValue];
      };

      // Simple test component first
      const TestApp = () => {
        const [count, setCount] = React.useState(0);
        const [tasks, setTasks] = useLocalStorage('test-tasks', []);
        
        return (
          <div className="min-h-screen bg-slate-100 p-8">
            <div className="max-w-4xl mx-auto">
              <header className="bg-white shadow-sm rounded-lg p-6 mb-8">
                <h1 className="text-3xl font-bold text-slate-800">Momentum Tracker - Test Version</h1>
                <p className="text-slate-600 mt-2">Testing if React and localStorage work!</p>
              </header>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h2 className="text-xl font-semibold text-slate-800 mb-4">React State Test</h2>
                  <div className="flex items-center gap-4">
                    <button 
                      onClick={() => setCount(count - 1)}
                      className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                    >
                      -
                    </button>
                    <span className="text-2xl font-bold text-slate-800">{count}</span>
                    <button 
                      onClick={() => setCount(count + 1)}
                      className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                    >
                      +
                    </button>
                  </div>
                  <p className="text-slate-600 mt-4">
                    {count === 0 ? "Click the buttons to test React state!" : `Count is ${count} - React is working! ðŸŽ‰`}
                  </p>
                </div>

                <div className="bg-white rounded-lg shadow-md p-6">
                  <h2 className="text-xl font-semibold text-slate-800 mb-4">LocalStorage Test</h2>
                  <div className="space-y-3">
                    <button 
                      onClick={() => setTasks([...tasks, { id: generateUUID(), text: `Task ${tasks.length + 1}`, created: new Date().toLocaleTimeString() }])}
                      className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                    >
                      Add Test Task
                    </button>
                    <button 
                      onClick={() => setTasks([])}
                      className="w-full px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
                    >
                      Clear All Tasks
                    </button>
                  </div>
                  <div className="mt-4">
                    <p className="text-sm text-slate-600 mb-2">Tasks in localStorage: {tasks.length}</p>
                    <div className="space-y-1 max-h-32 overflow-y-auto">
                      {tasks.map(task => (
                        <div key={task.id} className="text-sm bg-slate-50 p-2 rounded">
                          {task.text} - {task.created}
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>

              <div className="bg-white rounded-lg shadow-md p-6 mt-6">
                <h2 className="text-xl font-semibold text-slate-800 mb-4">System Check</h2>
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div>âœ… React: {typeof React !== 'undefined' ? 'Loaded' : 'Missing'}</div>
                  <div>âœ… ReactDOM: {typeof ReactDOM !== 'undefined' ? 'Loaded' : 'Missing'}</div>
                  <div>âœ… LocalStorage: {typeof localStorage !== 'undefined' ? 'Available' : 'Missing'}</div>
                  <div>âœ… UUID Generation: {generateUUID() ? 'Working' : 'Failed'}</div>
                </div>
                <p className="text-green-600 font-semibold mt-4">
                  If you can see this and the buttons work, your environment is ready for the full app! ðŸš€
                </p>
              </div>
            </div>
          </div>
        );
      };

      // Render the test app
      const rootElement = document.getElementById('root');
      if (rootElement) {
        const root = ReactDOM.createRoot(rootElement);
        root.render(<TestApp />);
      } else {
        console.error('Root element not found');
      }
    </script>
  </body>
</html>
